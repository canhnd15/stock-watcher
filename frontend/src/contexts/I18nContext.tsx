import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';

export type Language = 'vi' | 'en';

interface I18nContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string, params?: Record<string, string | number>) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

// Translation files
const translations = {
  vi: {
    // Common
    'common.search': 'Tìm kiếm',
    'common.loading': 'Đang tải...',
    'common.error': 'Lỗi',
    'common.success': 'Thành công',
    'common.save': 'Lưu',
    'common.cancel': 'Hủy',
    'common.delete': 'Xóa',
    'common.edit': 'Sửa',
    'common.add': 'Thêm',
    'common.close': 'Đóng',
    'common.confirm': 'Xác nhận',
    'common.yes': 'Có',
    'common.no': 'Không',
    'common.all': 'Tất cả',
    'common.active': 'Hoạt động',
    'common.inactive': 'Không hoạt động',
    'common.page': 'Trang',
    'common.of': 'của',
    'common.results': 'kết quả',
    'common.noResults': 'Không có kết quả',
    
    // Navigation
    'nav.trades': 'Giao dịch',
    'nav.trackedStocks': 'Cổ phiếu theo dõi',
    'nav.shortTermPortfolio': 'Portfolio ngắn hạn',
    'nav.suggestions': 'Gợi ý',
    'nav.signals': 'Tín hiệu',
    'nav.userManagement': 'Quản lý người dùng',
    'nav.systemConfig': 'Cấu hình hệ thống',
    
    // Auth
    'auth.login': 'Đăng nhập',
    'auth.logout': 'Đăng xuất',
    'auth.register': 'Đăng ký',
    'auth.username': 'Tên đăng nhập',
    'auth.password': 'Mật khẩu',
    'auth.email': 'Email',
    'auth.confirmPassword': 'Xác nhận mật khẩu',
    'auth.loginSuccess': 'Đăng nhập thành công!',
    'auth.loginFailed': 'Đăng nhập thất bại',
    'auth.registerSuccess': 'Đăng ký thành công!',
    'auth.registerFailed': 'Đăng ký thất bại',
    'auth.invalidCredentials': 'Tên đăng nhập hoặc mật khẩu không đúng',
    'auth.createAccount': 'Tạo tài khoản',
    'auth.alreadyHaveAccount': 'Đã có tài khoản?',
    'auth.dontHaveAccount': 'Chưa có tài khoản?',
    'auth.signInToAccess': 'Đăng nhập để truy cập bảng điều khiển',
    'auth.enterUsername': 'Nhập tên đăng nhập',
    'auth.enterPassword': 'Nhập mật khẩu',
    'auth.loggingIn': 'Đang đăng nhập...',
    'auth.joinTradeTracker': 'Tham gia Trade Tracker để bắt đầu theo dõi cổ phiếu',
    'auth.chooseUsername': 'Chọn tên đăng nhập',
    'auth.passwordMinLength': 'Tạo mật khẩu (tối thiểu 6 ký tự)',
    'auth.confirmPasswordPlaceholder': 'Xác nhận mật khẩu',
    'auth.passwordMismatch': 'Mật khẩu không khớp',
    'auth.passwordTooShort': 'Mật khẩu phải có ít nhất 6 ký tự',
    'auth.creatingAccount': 'Đang tạo tài khoản...',
    'auth.registerHere': 'Đăng ký tại đây',
    'auth.loginHere': 'Đăng nhập tại đây',
    'auth.welcomeMessage': 'Đăng ký thành công! Chào mừng đến với Trade Tracker.',
    
    // Trades
    'trades.title': 'Giao dịch',
    'trades.code': 'Mã',
    'trades.time': 'Thời gian',
    'trades.date': 'Ngày',
    'trades.side': 'Loại',
    'trades.price': 'Giá',
    'trades.volume': 'Khối lượng',
    'trades.type': 'Loại',
    'trades.buy': 'Mua',
    'trades.sell': 'Bán',
    'trades.fromDate': 'Từ ngày',
    'trades.toDate': 'Đến ngày',
    'trades.volumeRange': 'Khoảng khối lượng',
    'trades.totalVolume': 'Tổng khối lượng',
    'trades.buyVolume': 'Khối lượng mua',
    'trades.sellVolume': 'Khối lượng bán',
    'trades.buyCount': 'Số lần mua',
    'trades.sellCount': 'Số lần bán',
    'trades.export': 'Xuất Excel',
    'trades.import': 'Nhập Excel',
    'trades.selectStock': 'Chọn mã cổ phiếu...',
    'trades.searchStock': 'Tìm kiếm mã cổ phiếu...',
    'trades.noStockFound': 'Không tìm thấy mã cổ phiếu.',
    'trades.search': 'Tìm kiếm',
    'trades.allMatchingTrades': 'Tất cả giao dịch khớp',
    'trades.transactions': 'giao dịch',
    'trades.ingestCode': 'Mã nhập dữ liệu',
    'trades.selectIngestCode': 'Chọn mã nhập dữ liệu...',
    'trades.searchIngestCode': 'Tìm kiếm mã...',
    'trades.ingestAll': 'Nhập tất cả',
    'trades.ingesting': 'Đang nhập...',
    'trades.ingestSuccess': 'Nhập dữ liệu thành công',
    'trades.ingestFailed': 'Nhập dữ liệu thất bại',
    'trades.selectPageSize': 'Chọn kích thước trang',
    'trades.noResults': 'Không có kết quả',
    
    // Tracked Stocks
    'tracked.title': 'Cổ phiếu theo dõi',
    'tracked.addStock': 'Thêm cổ phiếu',
    'tracked.customCodes': 'Mã tùy chỉnh',
    'tracked.selectFromVN30': 'Chọn từ VN30',
    'tracked.stockCode': 'Mã cổ phiếu',
    'tracked.status': 'Trạng thái',
    'tracked.active': 'Hoạt động',
    'tracked.inactive': 'Tạm dừng',
    'tracked.addSuccess': 'Đã thêm {count} mã cổ phiếu',
    'tracked.deleteSuccess': 'Đã xóa {code}',
    'tracked.deleteConfirm': 'Bạn có chắc muốn xóa {code}?',
    
    // Signals
    'signals.title': 'Tín hiệu',
    'signals.realTimeSignals': 'Tín hiệu thời gian thực',
    'signals.buy': 'Mua',
    'signals.sell': 'Bán',
    'signals.score': 'Điểm',
    'signals.time': 'Thời gian',
    'signals.reason': 'Lý do',
    'signals.priceChange': 'Thay đổi giá',
    'signals.listening': 'Đang lắng nghe tín hiệu...',
    'signals.connecting': 'Đang kết nối...',
    'signals.clear': 'Xóa tất cả ({count})',
    'signals.refresh': 'Làm mới',
    'signals.active': 'Hoạt động',
    'signals.disconnected': 'Mất kết nối',
    'signals.liveSignalsDescription': 'Tín hiệu mua/bán trực tiếp dựa trên phân tích giao dịch',
    'signals.buyVolume': 'Khối lượng mua',
    'signals.sellVolume': 'Khối lượng bán',
    'signals.price': 'Giá',
    'signals.change': 'Thay đổi',
    'signals.signalsDetected': 'Tín hiệu xuất hiện khi phát hiện áp lực mua/bán mạnh',
    'signals.multiFactorAnalysis': '✓ Phân tích đa yếu tố (khối lượng, khối lớn, động lượng)',
    'signals.analyzingLast30Minutes': '✓ Phân tích 30 phút giao dịch gần nhất',
    'signals.minimumScoreThreshold': '✓ Ngưỡng điểm tối thiểu: 4 điểm',
    
    // Admin
    'admin.title': 'Quản lý người dùng',
    'admin.allUsers': 'Tất cả người dùng',
    'admin.userId': 'ID',
    'admin.username': 'Tên đăng nhập',
    'admin.email': 'Email',
    'admin.role': 'Vai trò',
    'admin.status': 'Trạng thái',
    'admin.created': 'Ngày tạo',
    'admin.lastLogin': 'Lần đăng nhập cuối',
    'admin.enable': 'Kích hoạt',
    'admin.disable': 'Vô hiệu hóa',
    'admin.deleteUser': 'Xóa người dùng',
    'admin.deleteConfirm': 'Bạn có chắc muốn xóa người dùng này?',
    'admin.deleteSuccess': 'Đã xóa người dùng',
    'admin.roleUpdated': 'Đã cập nhật vai trò',
    'admin.statusUpdated': 'Đã cập nhật trạng thái',
    
    // Roles
    'role.NORMAL': 'Thường',
    'role.VIP': 'VIP',
    'role.ADMIN': 'Quản trị',
    
    // Errors
    'error.loadFailed': 'Tải dữ liệu thất bại',
    'error.saveFailed': 'Lưu thất bại',
    'error.deleteFailed': 'Xóa thất bại',
    'error.operationFailed': 'Thao tác thất bại',
    'error.unauthorized': 'Không có quyền truy cập',
    'error.notFound': 'Không tìm thấy',
    
    // Pagination
    'pagination.pageSize': 'Kích thước trang',
    'pagination.currentPage': 'Trang hiện tại',
    'pagination.totalPages': 'Tổng số trang',
    'pagination.totalRecords': 'Tổng số bản ghi',
    'pagination.prev': 'Trước',
    'pagination.next': 'Tiếp',
    
    // Unauthorized
    'unauthorized.title': 'Truy cập bị từ chối',
    'unauthorized.message': 'Bạn không có quyền truy cập trang này',
    'unauthorized.contact': 'Vui lòng liên hệ quản trị viên để nâng cấp tài khoản',
    'unauthorized.goHome': 'Về trang chủ',
    
    // Portfolio Simulation
    'portfolio.title': 'Mô phỏng Portfolio',
    'portfolio.description': 'Thêm cổ phiếu từ danh sách VN30 hoặc nhập mã cổ phiếu tùy chỉnh để mô phỏng lợi nhuận portfolio. Thay đổi là tạm thời và không được lưu.',
    'portfolio.addStock': 'Thêm cổ phiếu',
    'portfolio.stockCode': 'Mã cổ phiếu',
    'portfolio.selectOrEnter': 'Chọn hoặc nhập mã cổ phiếu...',
    'portfolio.searchOrType': 'Tìm kiếm hoặc nhập mã cổ phiếu...',
    'portfolio.typeCustomCode': 'Nhập để nhập mã cổ phiếu tùy chỉnh (sẽ được xác thực)',
    'portfolio.customWillValidate': ' (Tùy chỉnh - sẽ xác thực)',
    'portfolio.costBasis': 'Giá vốn (VND)',
    'portfolio.costBasisPlaceholder': 'Giá mua',
    'portfolio.volume': 'Khối lượng (cổ phiếu)',
    'portfolio.volumePlaceholder': 'Số lượng cổ phiếu',
    'portfolio.targetPrice': 'Giá mục tiêu',
    'portfolio.targetPricePlaceholder': 'Giá mục tiêu',
    'portfolio.add': 'Thêm',
    'portfolio.simulatedStocks': 'Cổ phiếu mô phỏng ({count})',
    'portfolio.calculateProfit': 'Tính lợi nhuận',
    'portfolio.calculating': 'Đang tính...',
    'portfolio.code': 'Mã',
    'portfolio.costBasisCol': 'Giá vốn',
    'portfolio.volumeCol': 'Khối lượng',
    'portfolio.targetPriceCol': 'Giá mục tiêu',
    'portfolio.targetProfit': 'Lợi nhuận mục tiêu',
    'portfolio.marketPrice': 'Giá thị trường',
    'portfolio.totalNetValue': 'Tổng giá trị ròng',
    'portfolio.currentValue': 'Giá trị hiện tại',
    'portfolio.profit': 'Lợi nhuận',
    'portfolio.profitPercent': 'Lợi nhuận %',
    'portfolio.actions': 'Thao tác',
    'portfolio.total': 'Tổng:',
    'portfolio.noStocks': 'Chưa có cổ phiếu trong portfolio. Thêm cổ phiếu từ danh sách VN30 hoặc nhập mã cổ phiếu tùy chỉnh ở trên để bắt đầu mô phỏng.',
    'portfolio.loadingStocks': 'Đang tải cổ phiếu hiện có...',
    'portfolio.pleaseEnterCode': 'Vui lòng nhập mã cổ phiếu',
    'portfolio.stockAlreadyAdded': 'Cổ phiếu đã được thêm',
    'portfolio.invalidCode': 'Mã cổ phiếu không hợp lệ. Vui lòng nhập mã cổ phiếu hợp lệ.',
    'portfolio.stockNotFound': 'Không tìm thấy mã cổ phiếu hoặc giá thị trường không khả dụng',
    'portfolio.validateFailed': 'Xác thực mã cổ phiếu thất bại',
    'portfolio.loadFailed': 'Tải cổ phiếu hiện có thất bại',
    'portfolio.calculateSuccess': 'Tính toán portfolio thành công',
    'portfolio.calculateFailed': 'Tính toán portfolio thất bại',
    'portfolio.invalidCostBasis': 'Giá vốn không hợp lệ',
    'portfolio.invalidVolume': 'Khối lượng không hợp lệ',
    'portfolio.pleaseAddStock': 'Vui lòng thêm ít nhất một cổ phiếu',
    'portfolio.costBasisRequired': 'Giá vốn là bắt buộc để tính giá mục tiêu từ phần trăm',
    
    // Short Term Portfolio
    'shortTerm.title': 'Portfolio ngắn hạn',
    'shortTerm.simulatePortfolio': 'Mô phỏng Portfolio',
    'shortTerm.refreshMarketPrice': 'Làm mới giá thị trường',
    'shortTerm.refreshing': 'Đang làm mới...',
    'shortTerm.refreshSignals': 'Làm mới tín hiệu',
    'shortTerm.refreshingSignals': 'Đang làm mới...',
    'shortTerm.marketPriceRefreshed': 'Đã làm mới giá thị trường',
    'shortTerm.signalsRefreshed': 'Đã làm mới tín hiệu',
    'shortTerm.priceTracking': 'Theo dõi giá thời gian thực',
    'shortTerm.selectStocks': 'Chọn cổ phiếu để theo dõi',
    'shortTerm.selected': 'đã chọn',
    'shortTerm.loadingVN30': 'Đang tải mã VN30...',
    'shortTerm.noVN30Codes': 'Không có mã VN30',
    'shortTerm.saveSelected': 'Lưu mã đã chọn',
    'shortTerm.customCodes': 'Mã tùy chỉnh',
    'shortTerm.enterCustomCodes': 'Nhập mã cổ phiếu tùy chỉnh',
    'shortTerm.customCodesDescription': 'Thêm mã cổ phiếu không có trong danh sách VN30. Nhập mã cách nhau bằng dấu phẩy, khoảng trắng hoặc xuống dòng.',
    'shortTerm.customCodesExample': 'Ví dụ: FPT, VCB, HPG',
    'shortTerm.saveCustomCodes': 'Lưu mã tùy chỉnh',
    'shortTerm.enterCostBasis': 'Nhập giá vốn cho cổ phiếu đã chọn',
    'shortTerm.costBasisDescription': 'Nhập giá vốn (giá mua) cho từng cổ phiếu. Để trống nếu không áp dụng.',
    'shortTerm.costBasisOptional': 'Giá vốn (tùy chọn)',
    'shortTerm.editStock': 'Chỉnh sửa cổ phiếu theo dõi',
    'shortTerm.editStockDescription': 'Cập nhật mã cổ phiếu, trạng thái hoạt động và giá vốn.',
    'shortTerm.stock': 'Cổ phiếu',
    'shortTerm.costBasis': 'Giá vốn',
    'shortTerm.marketPrice': 'Giá thị trường',
    'shortTerm.volumeProfit': 'Khối lượng / Lợi nhuận',
    'shortTerm.lowPrice': 'Giá thấp',
    'shortTerm.highPrice': 'Giá cao',
    'shortTerm.maxVolume': 'Khối lượng tối đa',
    'shortTerm.actions': 'Thao tác',
    'shortTerm.loadFailed': 'Tải Portfolio ngắn hạn thất bại',
    'shortTerm.invalidVolume': 'Khối lượng không hợp lệ cho {code}',
    'shortTerm.stockNotFound': 'Không tìm thấy cổ phiếu cho {code}',
    'shortTerm.saveVolumeFailed': 'Lưu khối lượng thất bại cho {code}',
    'shortTerm.refreshFailed': 'Làm mới giá thị trường thất bại',
    'shortTerm.refreshSuccess': 'Đã làm mới giá thị trường: {successCount} thành công, {failedCount} thất bại',
    'shortTerm.unauthorized': 'Không được phép. Vui lòng đăng nhập lại.',
    'shortTerm.accessDenied': 'Truy cập bị từ chối. Yêu cầu vai trò VIP hoặc ADMIN.',
    'shortTerm.refreshSignalsFailed': 'Làm mới tín hiệu thất bại',
    'shortTerm.selectAtLeastOne': 'Vui lòng chọn ít nhất một mã cổ phiếu',
    'shortTerm.invalidCostBasis': 'Giá vốn không hợp lệ cho {code}. Vui lòng nhập số dương hợp lệ.',
    'shortTerm.addedSuccess': 'Đã thêm {count} mã cổ phiếu',
    'shortTerm.addFailed': 'Thêm một số mã thất bại',
    'shortTerm.updateFailed': 'Cập nhật {code} thất bại',
    'shortTerm.updatedSuccess': 'Đã cập nhật {code}',
    'shortTerm.deleteSuccess': 'Đã xóa {code} khỏi Portfolio ngắn hạn',
    'shortTerm.deleteFailed': 'Xóa {code} thất bại',
    'shortTerm.loadStatsFailed': 'Tải thống kê cho {code} thất bại',
    'shortTerm.saveChanges': 'Lưu thay đổi',
    'shortTerm.noStocks': 'Không có cổ phiếu',
    'shortTerm.noStocksDescription': 'Chọn cổ phiếu từ danh sách VN30 ở trên để bắt đầu theo dõi.',
    'shortTerm.deleteConfirm': 'Bạn có chắc muốn xóa <strong>{code}</strong> khỏi Portfolio ngắn hạn? Hành động này không thể hoàn tác.',
    
    // Suggestions
    'suggestions.title': 'Gợi ý',
    'suggestions.loading': 'Đang tải gợi ý...',
    'suggestions.noSuggestions': 'Không có gợi ý',
    'suggestions.error': 'Lỗi khi tải gợi ý',
    'suggestions.refreshed': 'Đã làm mới gợi ý',
    'suggestions.refresh': 'Làm mới',
    'suggestions.code': 'Mã',
    'suggestions.action': 'Hành động',
    'suggestions.strength': 'Độ mạnh',
    'suggestions.currentPrice': 'Giá hiện tại',
    'suggestions.targetPrice': 'Giá mục tiêu',
    'suggestions.confidence': 'Độ tin cậy',
    'suggestions.reason': 'Lý do',
    'suggestions.volume24h': 'Khối lượng 24h',
    'suggestions.score': 'Điểm',
    'suggestions.consensus': 'Đồng thuận',
    'suggestions.buyVotes': 'Phiếu mua',
    'suggestions.sellVotes': 'Phiếu bán',
    'suggestions.buy': 'Mua',
    'suggestions.sell': 'Bán',
    'suggestions.hold': 'Giữ',
    'suggestions.strong': 'Mạnh',
    'suggestions.moderate': 'Trung bình',
    'suggestions.weak': 'Yếu',
    'suggestions.neutral': 'Trung tính',
    'suggestions.high': 'Cao',
    'suggestions.medium': 'Trung bình',
    'suggestions.low': 'Thấp',
    'suggestions.buyPotential': 'Cổ phiếu có tiềm năng mua',
    'suggestions.sellSignals': 'Cổ phiếu có tín hiệu bán',
    'suggestions.requireData': 'Gợi ý yêu cầu ít nhất 5 ngày dữ liệu giao dịch.',
    'suggestions.priceTarget': 'Mục tiêu giá',
    'suggestions.disclaimer': '* Gợi ý dựa trên phân tích đa công thức 10 ngày (Động lượng Giá-Khối lượng, MA Crossover, RSI, Sức mạnh Xu hướng) và không nên được coi là lời khuyên tài chính',
    
    // Config
    'config.title': 'Cấu hình hệ thống',
    'config.stockDataIngestion': 'Nhập dữ liệu cổ phiếu',
    'config.ingestDescription': 'Nhập dữ liệu giao dịch thủ công cho các cổ phiếu cụ thể hoặc tất cả cổ phiếu VN30',
    'config.selectStock': 'Chọn cổ phiếu...',
    'config.searchStock': 'Tìm kiếm cổ phiếu...',
    'config.allVN30Stocks': 'Tất cả cổ phiếu VN30',
    'config.ingestNow': 'Nhập ngay',
    'config.ingesting': 'Đang nhập...',
    'config.ingestAll': 'Nhập tất cả cổ phiếu VN30',
    'config.ingestStock': 'Nhập {code}',
    'config.cronJobs': 'Công việc định kỳ',
    'config.vn30Cron': 'VN30 Cron Job',
    'config.trackedStocksCron': 'Tracked Stocks Cron Job',
    'config.signalCalculationCron': 'Signal Calculation Cron Job',
    'config.enabled': 'Đã bật',
    'config.disabled': 'Đã tắt',
    'config.exportImport': 'Xuất/Nhập dữ liệu',
    'config.exportTrades': 'Xuất giao dịch',
    'config.exportAll': 'Xuất tất cả',
    'config.exportDateRange': 'Xuất theo khoảng ngày',
    'config.fromDate': 'Từ ngày',
    'config.toDate': 'Đến ngày',
    'config.export': 'Xuất',
    'config.exporting': 'Đang xuất...',
    'config.importTrades': 'Nhập giao dịch',
    'config.selectFile': 'Chọn tệp Excel',
    'config.import': 'Nhập',
    'config.importing': 'Đang nhập...',
    'config.exportSuccess': 'Đã xuất tất cả giao dịch ra Excel',
    'config.exportSuccessRange': 'Đã xuất giao dịch ra Excel',
    'config.exportFailed': 'Xuất giao dịch thất bại',
    'config.importSuccess': 'Nhập thành công',
    'config.importFailed': 'Nhập giao dịch thất bại',
    'config.loadConfigFailed': 'Tải cấu hình thất bại',
    'config.exportImportDescription': 'Nhập giao dịch từ Excel hoặc xuất tất cả giao dịch ra Excel',
    'config.updateFailed': 'Cập nhật cấu hình thất bại',
    'config.ingestSuccess': 'Nhập dữ liệu thành công cho {code}',
    'config.ingestAllSuccess': 'Nhập dữ liệu hoàn tất cho tất cả cổ phiếu',
    'config.ingestFailed': 'Nhập dữ liệu thất bại cho {code}',
    'config.ingestAllFailed': 'Nhập dữ liệu thất bại cho tất cả cổ phiếu',
    
    // Header
    'header.dashboard': 'Bảng điều khiển',
    'header.language': 'Ngôn ngữ',
    
    // VIP Request
    'vip.request': 'Yêu cầu VIP',
    'vip.requestTitle': 'Yêu cầu nâng cấp tài khoản VIP',
    'vip.requestDescription': 'Gửi yêu cầu để nâng cấp tài khoản của bạn lên VIP và truy cập các tính năng cao cấp',
    'vip.requestSent': 'Yêu cầu đã được gửi',
    'vip.requestFailed': 'Gửi yêu cầu thất bại',
    'vip.alreadyRequested': 'Bạn đã gửi yêu cầu VIP',
    'vip.alreadyVIP': 'Bạn đã là thành viên VIP',
    'vip.sendRequest': 'Gửi yêu cầu',
    'vip.sending': 'Đang gửi...',
    
    // Realtime Price Tracking
    'realtime.title': 'Theo dõi giá thời gian thực',
    'realtime.selectStock': 'Chọn cổ phiếu',
    'realtime.loading': 'Đang tải...',
    'realtime.noData': 'Không có dữ liệu',
    'realtime.highestPrice': 'Giá cao nhất',
    'realtime.lowestPrice': 'Giá thấp nhất',
    'realtime.currentPrice': 'Giá hiện tại',
    
    // Tracked Stocks (additional)
    'tracked.marketPrice': 'Giá thị trường',
    'tracked.costBasis': 'Giá vốn',
    'tracked.targetPrice': 'Giá mục tiêu',
    'tracked.profit': 'Lợi nhuận',
    'tracked.profitPercent': 'Lợi nhuận %',
    'tracked.currentValue': 'Giá trị hiện tại',
    'tracked.totalValue': 'Tổng giá trị',
    'tracked.saveAll': 'Lưu tất cả',
    'tracked.saving': 'Đang lưu...',
    'tracked.saved': 'Đã lưu',
    'tracked.unsavedChanges': 'Có thay đổi chưa lưu',
    'tracked.noChanges': 'Không có thay đổi để lưu',
    'tracked.saveSuccess': 'Đã lưu tất cả thay đổi',
    'tracked.saveFailed': 'Lưu thất bại',
    'tracked.simulatePortfolio': 'Mô phỏng Portfolio',
    'tracked.saveToTracked': 'Lưu vào Cổ phiếu theo dõi',
    'tracked.saveToShortTerm': 'Lưu vào Portfolio ngắn hạn',
    
    // Trades (additional)
    'trades.priceRange': 'Khoảng giá',
    'trades.minPrice': 'Giá tối thiểu',
    'trades.maxPrice': 'Giá tối đa',
    'trades.minVolume': 'Khối lượng tối thiểu',
    'trades.maxVolume': 'Khối lượng tối đa',
    'trades.sortBy': 'Sắp xếp theo',
    'trades.sortAsc': 'Tăng dần',
    'trades.sortDesc': 'Giảm dần',
  },
  en: {
    // Common
    'common.search': 'Search',
    'common.loading': 'Loading...',
    'common.error': 'Error',
    'common.success': 'Success',
    'common.save': 'Save',
    'common.cancel': 'Cancel',
    'common.delete': 'Delete',
    'common.edit': 'Edit',
    'common.add': 'Add',
    'common.close': 'Close',
    'common.confirm': 'Confirm',
    'common.yes': 'Yes',
    'common.no': 'No',
    'common.all': 'All',
    'common.active': 'Active',
    'common.inactive': 'Inactive',
    'common.page': 'Page',
    'common.of': 'of',
    'common.results': 'results',
    'common.noResults': 'No results',
    
    // Navigation
    'nav.trades': 'Trades',
    'nav.trackedStocks': 'Tracked Stocks',
    'nav.shortTermPortfolio': 'Short-Term Portfolio',
    'nav.suggestions': 'Suggestions',
    'nav.signals': 'Signals',
    'nav.userManagement': 'User Management',
    'nav.systemConfig': 'System Config',
    
    // Auth
    'auth.login': 'Login',
    'auth.logout': 'Logout',
    'auth.register': 'Register',
    'auth.username': 'Username',
    'auth.password': 'Password',
    'auth.email': 'Email',
    'auth.confirmPassword': 'Confirm Password',
    'auth.loginSuccess': 'Login successful!',
    'auth.loginFailed': 'Login failed',
    'auth.registerSuccess': 'Registration successful!',
    'auth.registerFailed': 'Registration failed',
    'auth.invalidCredentials': 'Invalid username or password',
    'auth.createAccount': 'Create Account',
    'auth.alreadyHaveAccount': 'Already have an account?',
    'auth.dontHaveAccount': "Don't have an account?",
    'auth.signInToAccess': 'Sign in to access your dashboard',
    'auth.enterUsername': 'Enter your username',
    'auth.enterPassword': 'Enter your password',
    'auth.loggingIn': 'Logging in...',
    'auth.joinTradeTracker': 'Join Trade Tracker to start monitoring stocks',
    'auth.chooseUsername': 'Choose a username',
    'auth.passwordMinLength': 'Create a password (min 6 characters)',
    'auth.confirmPasswordPlaceholder': 'Confirm your password',
    'auth.passwordMismatch': 'Passwords do not match',
    'auth.passwordTooShort': 'Password must be at least 6 characters',
    'auth.creatingAccount': 'Creating account...',
    'auth.registerHere': 'Register here',
    'auth.loginHere': 'Login here',
    'auth.welcomeMessage': 'Registration successful! Welcome to Trade Tracker.',
    
    // Trades
    'trades.title': 'Trades',
    'trades.code': 'Code',
    'trades.time': 'Time',
    'trades.date': 'Date',
    'trades.side': 'Side',
    'trades.price': 'Price',
    'trades.volume': 'Volume',
    'trades.type': 'Type',
    'trades.buy': 'Buy',
    'trades.sell': 'Sell',
    'trades.fromDate': 'From Date',
    'trades.toDate': 'To Date',
    'trades.volumeRange': 'Volume Range',
    'trades.totalVolume': 'Total Volume',
    'trades.buyVolume': 'Buy Volume',
    'trades.sellVolume': 'Sell Volume',
    'trades.buyCount': 'Buy Count',
    'trades.sellCount': 'Sell Count',
    'trades.export': 'Export Excel',
    'trades.import': 'Import Excel',
    'trades.selectStock': 'Select stock...',
    'trades.searchStock': 'Search stock...',
    'trades.noStockFound': 'No stock found.',
    'trades.search': 'Search',
    'trades.allMatchingTrades': 'All matching trades',
    'trades.transactions': 'transactions',
    'trades.ingestCode': 'Ingest Code',
    'trades.selectIngestCode': 'Select ingest code...',
    'trades.searchIngestCode': 'Search code...',
    'trades.ingestAll': 'Ingest All',
    'trades.ingesting': 'Ingesting...',
    'trades.ingestSuccess': 'Data ingested successfully',
    'trades.ingestFailed': 'Data ingestion failed',
    'trades.selectPageSize': 'Select page size',
    'trades.noResults': 'No results',
    
    // Tracked Stocks
    'tracked.title': 'Tracked Stocks',
    'tracked.addStock': 'Add Stock',
    'tracked.customCodes': 'Custom Codes',
    'tracked.selectFromVN30': 'Select from VN30',
    'tracked.stockCode': 'Stock Code',
    'tracked.status': 'Status',
    'tracked.active': 'Active',
    'tracked.inactive': 'Inactive',
    'tracked.addSuccess': 'Added {count} stock code(s)',
    'tracked.deleteSuccess': 'Deleted {code}',
    'tracked.deleteConfirm': 'Are you sure you want to delete {code}?',
    
    // Signals
    'signals.title': 'Signals',
    'signals.realTimeSignals': 'Real-time Signals',
    'signals.buy': 'BUY',
    'signals.sell': 'SELL',
    'signals.score': 'Score',
    'signals.time': 'Time',
    'signals.reason': 'Reason',
    'signals.priceChange': 'Price Change',
    'signals.listening': 'Listening for signals...',
    'signals.connecting': 'Connecting...',
    'signals.clear': 'Clear All ({count})',
    'signals.refresh': 'Refresh',
    'signals.active': 'Active',
    'signals.disconnected': 'Disconnected',
    'signals.liveSignalsDescription': 'Live buy/sell signals based on trade analysis',
    'signals.buyVolume': 'Buy Volume',
    'signals.sellVolume': 'Sell Volume',
    'signals.price': 'Price',
    'signals.change': 'Change',
    'signals.signalsDetected': 'Signals appear when strong buy/sell pressure is detected',
    'signals.multiFactorAnalysis': '✓ Multi-factor analysis (volume, blocks, momentum)',
    'signals.analyzingLast30Minutes': '✓ Analyzing last 30 minutes of trades',
    'signals.minimumScoreThreshold': '✓ Minimum score threshold: 4 points',
    
    // Admin
    'admin.title': 'User Management',
    'admin.allUsers': 'All Users',
    'admin.userId': 'ID',
    'admin.username': 'Username',
    'admin.email': 'Email',
    'admin.role': 'Role',
    'admin.status': 'Status',
    'admin.created': 'Created',
    'admin.lastLogin': 'Last Login',
    'admin.enable': 'Enable',
    'admin.disable': 'Disable',
    'admin.deleteUser': 'Delete User',
    'admin.deleteConfirm': 'Are you sure you want to delete this user?',
    'admin.deleteSuccess': 'User deleted successfully',
    'admin.roleUpdated': 'User role updated',
    'admin.statusUpdated': 'User status updated',
    
    // Roles
    'role.NORMAL': 'Normal',
    'role.VIP': 'VIP',
    'role.ADMIN': 'Admin',
    
    // Errors
    'error.loadFailed': 'Failed to load data',
    'error.saveFailed': 'Failed to save',
    'error.deleteFailed': 'Failed to delete',
    'error.operationFailed': 'Operation failed',
    'error.unauthorized': 'Access denied',
    'error.notFound': 'Not found',
    
    // Pagination
    'pagination.pageSize': 'Page size',
    'pagination.currentPage': 'Current page',
    'pagination.totalPages': 'Total pages',
    'pagination.totalRecords': 'Total records',
    'pagination.prev': 'Prev',
    'pagination.next': 'Next',
    
    // Unauthorized
    'unauthorized.title': 'Access Denied',
    'unauthorized.message': 'You don\'t have permission to access this page',
    'unauthorized.contact': 'Please contact your administrator to upgrade your account',
    'unauthorized.goHome': 'Go to Dashboard',
    
    // Portfolio Simulation
    'portfolio.title': 'Portfolio Simulation',
    'portfolio.description': 'Add stocks from VN30 list or enter custom stock codes to simulate portfolio profit. Changes are temporary and not saved.',
    'portfolio.addStock': 'Add Stock',
    'portfolio.stockCode': 'Stock Code',
    'portfolio.selectOrEnter': 'Select or enter a stock code...',
    'portfolio.searchOrType': 'Search or type stock code...',
    'portfolio.typeCustomCode': 'Type to enter custom stock code (will be validated)',
    'portfolio.customWillValidate': ' (Custom - will validate)',
    'portfolio.costBasis': 'Cost Basis (VND)',
    'portfolio.costBasisPlaceholder': 'Purchase price',
    'portfolio.volume': 'Volume (shares)',
    'portfolio.volumePlaceholder': 'Number of shares',
    'portfolio.targetPrice': 'Target Price',
    'portfolio.targetPricePlaceholder': 'Target price',
    'portfolio.add': 'Add',
    'portfolio.simulatedStocks': 'Simulated Stocks ({count})',
    'portfolio.calculateProfit': 'Calculate Profit',
    'portfolio.calculating': 'Calculating...',
    'portfolio.code': 'Code',
    'portfolio.costBasisCol': 'Cost Basis',
    'portfolio.volumeCol': 'Volume',
    'portfolio.targetPriceCol': 'Target Price',
    'portfolio.targetProfit': 'Target Profit',
    'portfolio.marketPrice': 'Market Price',
    'portfolio.totalNetValue': 'Total Net Value',
    'portfolio.currentValue': 'Current Value',
    'portfolio.profit': 'Profit',
    'portfolio.profitPercent': 'Profit %',
    'portfolio.actions': 'Actions',
    'portfolio.total': 'Total:',
    'portfolio.noStocks': 'No stocks in portfolio. Add stocks from VN30 list or enter custom stock codes above to start simulation.',
    'portfolio.loadingStocks': 'Loading existing stocks...',
    'portfolio.pleaseEnterCode': 'Please enter a stock code',
    'portfolio.stockAlreadyAdded': 'Stock already added',
    'portfolio.invalidCode': 'Invalid stock code. Please enter a valid stock code.',
    'portfolio.stockNotFound': 'Stock code not found or market price unavailable',
    'portfolio.validateFailed': 'Failed to validate stock code',
    'portfolio.loadFailed': 'Failed to load existing stocks',
    'portfolio.calculateSuccess': 'Portfolio calculated successfully',
    'portfolio.calculateFailed': 'Failed to calculate portfolio',
    'portfolio.invalidCostBasis': 'Invalid cost basis',
    'portfolio.invalidVolume': 'Invalid volume',
    'portfolio.pleaseAddStock': 'Please add at least one stock',
    'portfolio.costBasisRequired': 'Cost basis is required to calculate target price from percentage',
    
    // Short Term Portfolio
    'shortTerm.title': 'Short-Term Portfolio',
    'shortTerm.simulatePortfolio': 'Simulate Portfolio',
    'shortTerm.refreshMarketPrice': 'Refresh Market Price',
    'shortTerm.refreshing': 'Refreshing...',
    'shortTerm.refreshSignals': 'Refresh Signals',
    'shortTerm.refreshingSignals': 'Refreshing...',
    'shortTerm.marketPriceRefreshed': 'Market prices refreshed',
    'shortTerm.signalsRefreshed': 'Signals refreshed',
    'shortTerm.priceTracking': 'Price Tracking Realtime',
    'shortTerm.selectStocks': 'Select Stocks For Tracking',
    'shortTerm.selected': 'selected',
    'shortTerm.loadingVN30': 'Loading VN30 codes...',
    'shortTerm.noVN30Codes': 'No VN30 codes available',
    'shortTerm.saveSelected': 'Save Selected Codes',
    'shortTerm.customCodes': 'Custom Codes',
    'shortTerm.enterCustomCodes': 'Enter Custom Stock Codes',
    'shortTerm.customCodesDescription': 'Add stock codes that are not in the VN30 list. Enter codes separated by comma, space, or newline.',
    'shortTerm.customCodesExample': 'Example: FPT, VCB, HPG',
    'shortTerm.saveCustomCodes': 'Save Custom Codes',
    'shortTerm.enterCostBasis': 'Enter Cost Basis for Selected Stocks',
    'shortTerm.costBasisDescription': 'Enter the cost basis (purchase price) for each stock. Leave empty if not applicable.',
    'shortTerm.costBasisOptional': 'Cost basis (optional)',
    'shortTerm.editStock': 'Edit Tracked Stock',
    'shortTerm.editStockDescription': 'Update the stock code, active status, and cost basis.',
    'shortTerm.stock': 'Stock',
    'shortTerm.costBasis': 'Cost Basis',
    'shortTerm.marketPrice': 'Market Price',
    'shortTerm.volumeProfit': 'Volume / Profit',
    'shortTerm.lowPrice': 'Low Price',
    'shortTerm.highPrice': 'High Price',
    'shortTerm.maxVolume': 'Max Volume',
    'shortTerm.actions': 'Actions',
    'shortTerm.loadFailed': 'Failed to load Short-Term Portfolio',
    'shortTerm.invalidVolume': 'Invalid volume for {code}',
    'shortTerm.stockNotFound': 'Stock not found for {code}',
    'shortTerm.saveVolumeFailed': 'Failed to save volume for {code}',
    'shortTerm.refreshFailed': 'Failed to refresh market prices',
    'shortTerm.refreshSuccess': 'Market prices refreshed: {successCount} successful, {failedCount} failed',
    'shortTerm.unauthorized': 'Unauthorized. Please log in again.',
    'shortTerm.accessDenied': 'Access denied. VIP or ADMIN role required.',
    'shortTerm.refreshSignalsFailed': 'Failed to refresh signals',
    'shortTerm.selectAtLeastOne': 'Please select at least one stock code',
    'shortTerm.invalidCostBasis': 'Invalid cost basis for {code}. Please enter a valid positive number.',
    'shortTerm.addedSuccess': 'Added {count} stock code(s)',
    'shortTerm.addFailed': 'Failed to add some codes',
    'shortTerm.updateFailed': 'Failed to update {code}',
    'shortTerm.updatedSuccess': 'Updated {code}',
    'shortTerm.deleteSuccess': 'Deleted {code} from Short-Term Portfolio',
    'shortTerm.deleteFailed': 'Failed to delete {code}',
    'shortTerm.loadStatsFailed': 'Failed to load statistics for {code}',
    'shortTerm.saveChanges': 'Save Changes',
    'shortTerm.noStocks': 'No stocks',
    'shortTerm.noStocksDescription': 'Select stocks from the VN30 list above to start tracking.',
    'shortTerm.deleteConfirm': 'Are you sure you want to remove <strong>{code}</strong> from Short-Term Portfolio? This action cannot be undone.',
    
    // Suggestions
    'suggestions.title': 'Suggestions',
    'suggestions.loading': 'Loading suggestions...',
    'suggestions.noSuggestions': 'No suggestions',
    'suggestions.error': 'Error loading suggestions',
    'suggestions.refreshed': 'Suggestions refreshed',
    'suggestions.refresh': 'Refresh',
    'suggestions.code': 'Code',
    'suggestions.action': 'Action',
    'suggestions.strength': 'Strength',
    'suggestions.currentPrice': 'Current Price',
    'suggestions.targetPrice': 'Target Price',
    'suggestions.confidence': 'Confidence',
    'suggestions.reason': 'Reason',
    'suggestions.volume24h': 'Volume 24h',
    'suggestions.score': 'Score',
    'suggestions.consensus': 'Consensus',
    'suggestions.buyVotes': 'Buy Votes',
    'suggestions.sellVotes': 'Sell Votes',
    'suggestions.buy': 'Buy',
    'suggestions.sell': 'Sell',
    'suggestions.hold': 'Hold',
    'suggestions.strong': 'Strong',
    'suggestions.moderate': 'Moderate',
    'suggestions.weak': 'Weak',
    'suggestions.neutral': 'Neutral',
    'suggestions.high': 'High',
    'suggestions.medium': 'Medium',
    'suggestions.low': 'Low',
    'suggestions.buyPotential': 'Stocks showing buy potential',
    'suggestions.sellSignals': 'Stocks showing sell signals',
    'suggestions.requireData': 'Suggestions require at least 5 days of trading data.',
    'suggestions.priceTarget': 'Price Target',
    'suggestions.disclaimer': '* Suggestions are based on 10-day multi-formula analysis (Volume-Price Momentum, MA Crossover, RSI, Trend Strength) and should not be considered financial advice',
    
    // Config
    'config.title': 'System Configuration',
    'config.stockDataIngestion': 'Stock Data Ingestion',
    'config.ingestDescription': 'Manually ingest trade data for specific stocks or all VN30 stocks',
    'config.selectStock': 'Select stock...',
    'config.searchStock': 'Search stock...',
    'config.allVN30Stocks': 'All VN30 Stocks',
    'config.ingestNow': 'Ingest Now',
    'config.ingesting': 'Ingesting...',
    'config.ingestAll': 'Ingest all VN30 stocks',
    'config.ingestStock': 'Ingest {code}',
    'config.cronJobs': 'Cron Jobs',
    'config.vn30Cron': 'VN30 Cron Job',
    'config.trackedStocksCron': 'Tracked Stocks Cron Job',
    'config.signalCalculationCron': 'Signal Calculation Cron Job',
    'config.enabled': 'Enabled',
    'config.disabled': 'Disabled',
    'config.exportImport': 'Export/Import Data',
    'config.exportTrades': 'Export Trades',
    'config.exportAll': 'Export All',
    'config.exportDateRange': 'Export by Date Range',
    'config.fromDate': 'From Date',
    'config.toDate': 'To Date',
    'config.export': 'Export',
    'config.exporting': 'Exporting...',
    'config.importTrades': 'Import Trades',
    'config.selectFile': 'Select Excel file',
    'config.import': 'Import',
    'config.importing': 'Importing...',
    'config.exportSuccess': 'Exported all trades to Excel',
    'config.exportSuccessRange': 'Exported trades to Excel',
    'config.exportFailed': 'Failed to export trades',
    'config.importSuccess': 'Imported successfully',
    'config.importFailed': 'Failed to import trades',
    'config.loadConfigFailed': 'Failed to load configuration',
    'config.exportImportDescription': 'Import trades from Excel or export all trades to Excel',
    'config.updateFailed': 'Failed to update configuration',
    'config.ingestSuccess': 'Ingestion completed for {code}',
    'config.ingestAllSuccess': 'Ingestion completed for all stocks',
    'config.ingestFailed': 'Failed to ingest {code}',
    'config.ingestAllFailed': 'Failed to ingest all stocks',
    
    // Header
    'header.dashboard': 'Dashboard',
    'header.language': 'Language',
    
    // VIP Request
    'vip.request': 'VIP Request',
    'vip.requestTitle': 'Request VIP Account Upgrade',
    'vip.requestDescription': 'Submit a request to upgrade your account to VIP and access premium features',
    'vip.requestSent': 'Request sent successfully',
    'vip.requestFailed': 'Failed to send request',
    'vip.alreadyRequested': 'You have already requested VIP access',
    'vip.alreadyVIP': 'You are already a VIP member',
    'vip.sendRequest': 'Send Request',
    'vip.sending': 'Sending...',
    
    // Realtime Price Tracking
    'realtime.title': 'Realtime Price Tracking',
    'realtime.selectStock': 'Select Stock',
    'realtime.loading': 'Loading...',
    'realtime.noData': 'No data available',
    'realtime.highestPrice': 'Highest Price',
    'realtime.lowestPrice': 'Lowest Price',
    'realtime.currentPrice': 'Current Price',
    
    // Tracked Stocks (additional)
    'tracked.marketPrice': 'Market Price',
    'tracked.costBasis': 'Cost Basis',
    'tracked.targetPrice': 'Target Price',
    'tracked.profit': 'Profit',
    'tracked.profitPercent': 'Profit %',
    'tracked.currentValue': 'Current Value',
    'tracked.totalValue': 'Total Value',
    'tracked.saveAll': 'Save All',
    'tracked.saving': 'Saving...',
    'tracked.saved': 'Saved',
    'tracked.unsavedChanges': 'Unsaved changes',
    'tracked.noChanges': 'No changes to save',
    'tracked.saveSuccess': 'All changes saved successfully',
    'tracked.saveFailed': 'Failed to save',
    'tracked.simulatePortfolio': 'Simulate Portfolio',
    'tracked.saveToTracked': 'Save to Tracked Stocks',
    'tracked.saveToShortTerm': 'Save to Short-Term Portfolio',
    
    // Trades (additional)
    'trades.priceRange': 'Price Range',
    'trades.minPrice': 'Min Price',
    'trades.maxPrice': 'Max Price',
    'trades.minVolume': 'Min Volume',
    'trades.maxVolume': 'Max Volume',
    'trades.sortBy': 'Sort By',
    'trades.sortAsc': 'Ascending',
    'trades.sortDesc': 'Descending',
  },
};

// Simple translation function with placeholder support
const translate = (key: string, lang: Language): string => {
  // Directly access the flat key in translations
  const langTranslations = translations[lang];
  let value = langTranslations?.[key];
  
  // If not found, try English as fallback
  if (value === undefined && lang === 'vi') {
    value = translations.en?.[key];
  }
  
  // If still not found, return the key itself
  return value || key;
};

interface I18nProviderProps {
  children: ReactNode;
}

export const I18nProvider: React.FC<I18nProviderProps> = ({ children }) => {
  const [language, setLanguageState] = useState<Language>(() => {
    const saved = localStorage.getItem('language') as Language;
    return saved || 'vi'; // Default to Vietnamese
  });

  useEffect(() => {
    localStorage.setItem('language', language);
  }, [language]);

  const setLanguage = (lang: Language) => {
    setLanguageState(lang);
  };

  const t = (key: string, params?: Record<string, string | number>): string => {
    let translated = translate(key, language);
    
    // Replace placeholders like {count}, {code}, etc.
    if (params) {
      Object.entries(params).forEach(([paramKey, paramValue]) => {
        translated = translated.replace(`{${paramKey}}`, String(paramValue));
      });
    }
    
    return translated;
  };

  return (
    <I18nContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = () => {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useI18n must be used within I18nProvider');
  }
  return context;
};

